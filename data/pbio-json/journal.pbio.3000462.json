{
  "schema": "https://data.sciveyor.com/schema",
  "version": 5,
  "id": "doi:10.1371/journal.pbio.3000462",
  "doi": "10.1371/journal.pbio.3000462",
  "externalIds": [
    "pii:PBIOLOGY-D-19-01779",
    "pmid:32697779",
    "pmcid:PMC7481021"
  ],
  "license": "This is an open access article distributed under the terms of the Creative Commons Attribution License, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.",
  "licenseUrl": "http://creativecommons.org/licenses/by/4.0/",
  "dataSource": "Public Library of Science",
  "dataSourceUrl": "https://data.sciveyor.com/source/plos",
  "dataSourceVersion": 1,
  "type": "article",
  "title": "Experimental–numerical method for calculating bending moments in swimming fish shows that fish larvae control undulatory swimming with simple actuation",
  "authors": [
    {
      "name": "Cees J. Voesenek",
      "first": "Cees J.",
      "last": "Voesenek",
      "affiliation": "Experimental Zoology Group, Department of Animal Sciences, Wageningen University, Wageningen, the Netherlands",
      "externalIds": [
        "orcid:https://orcid.org/0000-0002-5467-8963"
      ]
    },
    {
      "name": "Gen Li",
      "first": "Gen",
      "last": "Li",
      "affiliation": "Department of Mathematical Science and Advanced Technology, Japan Agency for Marine-Earth Science and Technology (JAMSTEC), Yokohama, Japan",
      "externalIds": [
        "orcid:https://orcid.org/0000-0002-4423-3266"
      ]
    },
    {
      "name": "Florian T. Muijres",
      "first": "Florian T.",
      "last": "Muijres",
      "affiliation": "Experimental Zoology Group, Department of Animal Sciences, Wageningen University, Wageningen, the Netherlands",
      "externalIds": [
        "orcid:https://orcid.org/0000-0002-5668-0653"
      ]
    },
    {
      "name": "Johan L. van Leeuwen",
      "first": "Johan L.",
      "last": "van Leeuwen",
      "affiliation": "Experimental Zoology Group, Department of Animal Sciences, Wageningen University, Wageningen, the Netherlands",
      "externalIds": [
        "orcid:https://orcid.org/0000-0002-4433-880X"
      ]
    }
  ],
  "journal": "PLOS Biology",
  "date": "2020-07-22",
  "dateAccepted": "2020-06-30",
  "dateReceived": "2019-06-21",
  "volume": "18",
  "number": "7",
  "pages": "e3000462",
  "tags": [
    "Acceleration",
    "Animal models",
    "Animal studies",
    "Animals",
    "Bending",
    "Biological locomotion",
    "Classical mechanics",
    "Continuum mechanics",
    "Damage mechanics",
    "Deformation",
    "Developmental biology",
    "Discipline-v3/Acceleration",
    "Discipline-v3/Animal models",
    "Discipline-v3/Animal studies",
    "Discipline-v3/Animals",
    "Discipline-v3/Bending",
    "Discipline-v3/Biological locomotion",
    "Discipline-v3/Biology and life sciences",
    "Discipline-v3/Classical mechanics",
    "Discipline-v3/Continuum mechanics",
    "Discipline-v3/Damage mechanics",
    "Discipline-v3/Deformation",
    "Discipline-v3/Developmental biology",
    "Discipline-v3/Eukaryota",
    "Discipline-v3/Experimental organism systems",
    "Discipline-v3/Fish",
    "Discipline-v3/Fluid dynamics",
    "Discipline-v3/Fluid mechanics",
    "Discipline-v3/Larvae",
    "Discipline-v3/Life cycles",
    "Discipline-v3/Model organisms",
    "Discipline-v3/Organisms",
    "Discipline-v3/Osteichthyes",
    "Discipline-v3/Physical sciences",
    "Discipline-v3/Physics",
    "Discipline-v3/Physiology",
    "Discipline-v3/Research and analysis methods",
    "Discipline-v3/Swimming",
    "Discipline-v3/Vertebrates",
    "Discipline-v3/Zebrafish",
    "Discipline-v3/Zoology",
    "Eukaryota",
    "Experimental organism systems",
    "Fish",
    "Fluid dynamics",
    "Fluid mechanics",
    "Larvae",
    "Life cycles",
    "Model organisms",
    "Organisms",
    "Osteichthyes",
    "Physics",
    "Physiology",
    "Swimming",
    "Type/Methods and Resources",
    "Vertebrates",
    "Zebrafish",
    "Zoology"
  ],
  "abstract": "Most fish swim with body undulations that result from fluid–structure interactions between the fish’s internal tissues and the surrounding water. Gaining insight into these complex fluid–structure interactions is essential to understand how fish swim. To this end, we developed a dedicated experimental–numerical inverse dynamics approach to calculate the lateral bending moment distributions for a large-amplitude undulatory swimmer that moves freely in three-dimensional space. We combined automated motion tracking from multiple synchronised high-speed video sequences, computation of fluid dynamic stresses on the swimmer’s body from computational fluid dynamics, and bending moment calculations using these stresses as input for a novel beam model of the body. The bending moment, which represent the system’s net actuation, varies over time and along the fish’s central axis due to muscle actions, passive tissues, inertia, and fluid dynamics. Our three-dimensional analysis of 113 swimming events of zebrafish larvae ranging in age from 3 to 12 days after fertilisation shows that these bending moment patterns are not only relatively simple but also strikingly similar throughout early development and from fast starts to periodic swimming. This suggests that fish larvae may produce and adjust swimming movements relatively simply, yet effectively, while restructuring their neuromuscular control system throughout their rapid development.",
  "fullText": "Introduction\n\nSwimming is a vital component of the fitness of a fish because fish swim to search for food, hunt prey, escape from predators, migrate and disperse, and manoeuvre through complex environments. Many fish species swim by performing body undulations that result from an interaction between body tissues and the surrounding water [1,2]. Understanding these complex fluid–structure interactions is crucial to gain insight into the mechanics and control of fish swimming [3].\n\nTo analyse the fluid–structure interactions during swimming, we need to understand the external fluid mechanics (water), the internal solid mechanics (skin, muscle, skeleton), and their coupling. During swimming, the body of the fish moves through the water, inducing a flow around it [4,5]. The resulting fluid dynamic forces interact with the body tissues via the skin, resulting in a change in deformation. This deformation will change the motion of the surface of the body, which influences the fluid dynamic forces, thus forming a loop of tight coupling between the fluid mechanics and the internal solid mechanics [2,6,7]. This complex two-way fluid–structure interaction creates the typical travelling wave pattern observed in swimming fish [8,9].\n\nTo better understand how fish swim, we need insight into the internal mechanics of the axial muscles and passive tissues that actuate the motion. Muscle activation patterns can be measured directly with electromyography, in which electrodes are inserted in the muscles to measure potential differences [10–12]. However, this technique may incur considerable changes in swimming behaviour. This holds especially for research on fish larvae; electromyographical experiments require the larvae to be paralysed [13] or fixed in place [14], thus changing the fluid–structure interactions that produce the body wave [15]. Furthermore, the resolution along the body is limited by the number of inserted electrodes.\n\nAn alternative is an inverse dynamics approach [16] in which net forces and moments are calculated from measured kinematics. Hess and Videler [17] used a simplified small-amplitude fluid [18] and internal body model to estimate bending moments along the central axis of saithe from the motion of its centreline. The bending moment is defined for each transversal slice along the body as the sum of the moments produced by the muscles and passive tissues, counteracting the moments due to inertia and surrounding water [17,19,20]. Because the muscles are the only component in the system that produces net positive work over a cycle, bending moment distributions are the net actuation of the system and hint toward properties of the muscle activation patterns. Previous pioneering studies [17,19] used a basic small-amplitude beam model and simplified fluid dynamics to compute bending moments for only a few cases of periodic swimming in the inertial regime. However, swimming fish often use large undulatory amplitudes, and smaller fish or fish larvae may swim in the intermediate Reynolds regime, in which inviscid fluid models are invalid. In addition, for many fish species, the majority of swimming (e.g., starts, turns, feeding strikes) cannot be analysed under periodic assumptions. In our newly developed method, we therefore removed these simplifying assumptions. We used three-dimensional reconstructed kinematics [21]; beam theory supporting aperiodic, arbitrarily large deformation amplitudes; and full numerical solutions of the incompressible Navier–Stokes equations to calculate fluid dynamic forces (Fig 1).\n\nTo demonstrate this method, we examined the swimming performance of fish larvae. Zebrafish (Danio rerio, Hamilton 1822) larvae, the subject of this study, can swim immediately after hatching at considerable speed and tail-beat frequency [3,22,23]. In the next days of development, their bodies change considerably, both externally and internally [24]. In addition, the larvae refine their control of swimming [22,25,26] and improve swimming performance [22,23]. These changes and improvements raise the following question: Do fish larvae produce swimming differently across early development and at different swimming speeds and accelerations?\n\nTo answer this question, we calculated bending moments for 113 swimming sequences of larvae aged between 3 and 12 days postfertilisation (dpf). The reconstructed bending moment patterns are qualitatively similar across development, speed, and acceleration. Rather than change the spatiotemporal distribution of bending moments, fish larvae control speed and acceleration with only the amplitude and duration of the bending moment patterns. This suggests that fish larvae retain the same relatively simple net actuation to produce swimming across early development, despite the large neuromuscular restructuring throughout development and the complex physics that determines the resulting motion.\n\nResults\n\nWe have developed an inverse dynamics method for reconstructing bending moments of arbitrary three-dimensional swimming motion from multicamera high-speed video. The method comprises three main novel components: (1) three-dimensional motion tracking of freely swimming fish using machine vision techniques [21], (2) calculation of fluid forces acting on a swimming fish using computational fluid dynamics (CFD), and (3) bending moment reconstruction along a swimming fish using our large-amplitude beam model. An extended overview of the method is given in the Materials and methods section, and all (mathematical) details are provided in the S1 Text. Underlying data can be found in the accompanying data repository [27].\n\nWe highlighted the use and validity of our inverse dynamics method studying fish swimming using two approaches. First, we validated our methodology using a series of tests. Secondly, we used our method to investigate bending moment distributions of a large data set of swimming larval zebrafish.\n\nTesting and validation of our method\n\nValidation of the methods and models used is described in detail in previous literature and the S1 Text. We validated the automated three-dimensional tracking method in a previous study [21]. In the S1 Text, section S5, we validate the moment reconstruction method with synthetically generated data. In S1 Text, section S6, we validated the CFD model used in the present method against a previously published, experimentally validated method [28–30], showing excellent qualitative and good quantitative agreement.\n\nNext to these validations, we tested our large-amplitude beam model by comparing it with previous small-amplitude approaches [19,20,31]. In this comparison, we applied both beam models to the synthetically generated reference data that we used to validate our bending moment reconstruction method (S1 Text, section S5). These reference data consist of periodic swimming motions at three peak-to-peak tail-beat amplitudes (a small amplitude of 0.12ℓ, a medium amplitude of 0.20ℓ, and a large amplitude of 0.35ℓ; ℓ is body length).\n\nThe small-amplitude model showed error peaks of 7.6%, 16.4%, and 37.4% for the small-, medium-, and large-amplitude swimming motions, respectively (Figs 2 and 3). In contrast, our large-amplitude model showed error peaks of, respectively, 0.5%, 0.95%, and 5.1% at these same amplitudes (Figs 2 and 3). This showed that our large-amplitude model reconstructs bending moments with considerably lower errors at any amplitude but particularly so at larger amplitudes. Even at relatively small tail-beat amplitudes of 0.12ℓ, the present model shows errors of an order of magnitude smaller than the small-amplitude model. In addition to the differences in bending moment amplitude, the small-amplitude model also shows different dynamics; for example, the bending moment peaks are shifted in phase with respect to the reference, whereas the present model remains close to the reference in both phase and amplitude (Fig 2D).\n\nThe increasing error with amplitude is partly caused by the inaccurate small-amplitude motion model. This is illustrated in Fig 3C–3E, which shows the motion of the reference swimmer at its most extreme point represented by the small-amplitude model and the present model. Especially at larger amplitudes, it becomes necessary to consider the deformation in longitudinal direction to be able to reconstruct the motion accurately. The small-amplitude model changes centreline length considerably during the motion because of the lack of explicit modelling of deformation in x direction. In addition to this motion simplification, the small-amplitude model also assumes that the deformation angles are close to zero (and hence sin θ≈tan θ≈θ; cos θ≈1); this is not the case for the zebrafish of this study, as the angles are often well outside the range of validity of this assumption (e.g., Fig 3F).\n\nThe largest amplitude in our comparison is still considerably smaller than the tail-beat amplitudes exhibited by the zebrafish larvae (Fig 3F); thus, for these larvae, the small-amplitude model would produce even larger reconstruction errors of bending moments. A similar problem occurs for adult fish. Although they tend to swim at lower relative motion amplitudes than those of larval fish, during (near-)periodic swimming, many are still in the range of ‘medium’ tail-beat amplitudes [32]. Hence, even for adult fish swimming with moderate tail-beat amplitudes, dropping the small-amplitude assumption results in much-reduced errors.\n\nIn addition to the small-amplitude assumption, the model used in previous studies [17,19,20] assumes periodic motion. There is hardly close-to-periodic motion in our experimental data, necessitating a model that drops this assumption. In general, aperiodicity is common in fish swimming; in many cases, the aperiodic motions, e.g., fast starts, turns, and forward acceleration, are most interesting to analyse bending moments for.\n\nDemonstration of the method: Bending moments in larval zebrafish\n\nTo illustrate how the method can be applied, we used it to investigate bending moment distributions of a large data set of swimming larval zebrafish. The results of this example analysis are presented in this section.\n\nExample analysis of the bending moments of a larval swimming bout\n\nFig 1 shows an example analysis of a single swimming bout of a larval zebrafish. We analysed the body motion from the footage of three synchronised high-speed video cameras with an automated method [21] (Fig 1A and 1B). We then used these data to compute the flow field around the fish with a CFD method, which is visualised at one moment during the event with vorticity isocontours (Fig 1C). The flow field was postprocessed to calculate the fluid dynamic stress on the body surface (Fig 1D, same instant as Fig 1C) and the fluid dynamic force distribution along the fish axis (Fig 1E, same instant as Fig 1C). Finally, we combined all these data to compute the bending moments along the body during the swimming bout (Fig 1F).\n\nOverview of an individual swimming sequence\n\nWe performed phase averaging on a periodic section of a swimming sequence of a 3-dpf zebrafish larva to illustrate how bending moments and bending powers vary along the body during swimming. We selected four half tail beats (Fig 4A) based on the periodicity of the body curvature. We averaged body curvature, bending moment, kinetic power, and fluid power over these half beats.\n\nBody curvature (Fig 4B and 4C) shows a travelling wave pattern behind the stiff head with one positive and one negative peak per cycle. The highest curvatures are reached near the tail, at around 80% of the body length (ℓ), where body width is relatively small. Curvature waves originate from around 0.25ℓ, which is close to where the most anterior axial muscles are located. They then travel at approximately constant speed (3.3ℓ per tail beat) posteriorly, growing in amplitude until close to the tail, and finally dropping to zero amplitude at the tail tip.\n\nBending moments (Fig 4D) show a positive and a negative peak during swimming, corresponding to the direction of the tail beat, but preceding it in phase along most of the body. The peak amplitude occurs around 0.4ℓ, corresponding to the area with the highest muscle cross section (Fig 4E). Bending moments in the head and tail regions are low because of the free-end boundary conditions (in which the bending moment must be zero); the absence of muscle; and in the tail region, the limited cross-sectional area. Like curvature, the bending moment also shows a travelling wave pattern, but its wave speed is more than twice as high as the curvature wave speed (7.1ℓ per tail beat).\n\nThe power used by the body to move the fluid (Fig 4F) shows a large peak close to the tip of the tail. The motion amplitude is large here (Fig 4A and 4B), as well as the lateral velocities; therefore, fluid forces are large. Because power is the product of velocity and force, most power is expected to be transferred to the fluid here. The kinetic power, defined as the time rate of change in kinetic energy of the body, is smaller in magnitude than the fluid power (Fig 4G). The head shows considerable variation in kinetic energy over a tail-beat cycle owing to its relatively large mass and side-to-side motion. There is a dip in kinetic energy fluctuations in the anterior region of the yolk sac. In the remainder of the body, the kinetic power shows a travelling wave pattern caused by the travelling wave character of the body motion and, hence, its speed. The resultant power (Fig 4H), defined as the sum of the fluid and kinetic power, is dominated by the fluid power.\n\nSwimming effort and vigour\n\nWe reconstructed three-dimensional kinematics from 113 video sequences of fast-start responses followed by swimming, calculated flow fields throughout the sequence with CFD, and fitted distributions of internal forces and moments. These swimming sequences hardly contain periodic swimming. To analyse the data despite their aperiodicity, we subdivided them into half beats based on zero crossings of the bending moment in the midpoint along the centreline (Fig 1F and 1G). For each of these 285 half beats, we calculated the period length, mean speed, mean acceleration of the centre of mass to the next half beat, and peak (95th percentile) bending moment.\n\nTo reduce the number of parameters for the analysis, we identified combinations of parameters with high explanatory capacity—one parameter related to the ‘input’ delivered by the fish and one related to the ‘output’ of the swimming motion.\n\nTo control swimming, the fish has two main input parameters to change the bending moment (see section below): the duration of the half beat (thalf) and the bending moment amplitude (i.e., the peak bending moment Mpeak). We define the ‘swimming effort’ as E=Mpeakthalf−1—higher bending moments and shorter periods increase E. We fitted a generalised linear model (gamma distribution, log link function) with MATLAB (fitglm, R2018b, The Mathworks) and the Statistics and Machine Learning Toolbox (R2018b, The Mathworks). This showed that the swimming effort correlates significantly with the mean resultant power (Fig 5A; P &lt; 0.0001), with an exponent of 1.06—close to linear.\n\nThe most important output parameters for swimming motion are the speed and acceleration, so we define a summarising parameter that includes both. We expect the net propulsive force to scale with the mass of the fish, its acceleration, and its squared speed (from the dynamic pressure). We can give an indication of the strength of the output of a swimming motion by looking at the estimated amount of required propulsive force for the combination of speed and acceleration. Based on this, we define an output parameter swimming vigour as V = m(cv2+a), where m is body mass, v is swimming speed, and a is mean acceleration (i.e., change of speed to the next half beat per unit of time). The coefficient c is calculated with an optimisation algorithm that minimised the sum of squared errors of a linear fit of vigour to effort with total least squares. The fitted value of 517.7 m−1 results in a clear trend of vigour as a function of effort (Fig 5B; generalised linear model fit with gamma distribution and log link function: P &lt; 0.0001), collapsing the broad clouds of speed and acceleration (Fig 5C and 5D).\n\nBending moment distributions are similar across swimming vigour and development\n\nTo assess how bending moment patterns differ across vigour and development (indicated by body length [24]), we compared bending moment patterns normalised by their amplitude and duration. This allowed us to compare bending moment patterns of half beats performed with different swimming effort and assess whether a common spatiotemporal pattern exists that is independent of the duration and amplitude. We normalised the bending moment distribution of each half beat by dividing by the peak bending moment. We then calculated the mean and standard deviation (Fig 6A and 6B) of the normalised distributions of all half beats. The standard deviation (Fig 6B) is relatively small, locally peaking at 0.24, which is caused primarily by variation in the peak phase (Fig 6E and 6F).\n\nTo further assess the spatiotemporal similarity of the patterns, we calculated the mean absolute difference of each point in the bending moment distribution to the corresponding point in the mean distribution—effectively the overall difference of each individual pattern from the mean over all patterns. The mean of these differences over all half beats is 0.091 ± 0.028—the differences are relatively low and of similar magnitude across half beats. Thus, the patterns look similar across different developmental stages and swimming vigour. Note that the peak value is smaller than 1 (Fig 6A) because the peak location shows variation in both location along the body and phase (Fig 6C–6F).\n\nTo analyse how the bending moment distributions change with vigour and body length (i.e., developmental stage), we calculate the centre of volume of the bending moment distributions. We computed this as the average location along the body and time in the half beat, weighted by the bending moment at each point along the body and time instant; this is equivalent to calculating the centre of mass along two axes. The centre of volume of the individual bending moment patterns (Fig 6C–6F) lies around 0.5ℓ along the body length and 25% of the tail beat (i.e., 50% of the half beat). The location along the body varies little across body length and swimming vigour. The phase (i.e., time relative to the tail-beat duration) shows more variation over body length and vigour but shows no clear pattern. We fitted linear models with MATLAB (fitlm, R2018b, The Mathworks) with the centre of volume location along the body and in phase as response variable and body length and vigour as predictors. The slopes for the centre of volume position along the body are not significantly different from 0 for length (P = 0.071), vigour (P = 0.78), or their interaction (P = 0.78). The slopes for the phase of the centre of volume are not significantly different from zero for length (P = 0.32) and the interaction between length and vigour (P = 0.065) but are marginally significant for vigour (P = 0.049).\n\nAlthough the spatiotemporal distributions (i.e., wave length, amplitude distribution, etc.) of the bending moments are similar across lengths (i.e., developmental stage), the duration and amplitude vary (Fig 6G and 6H). As the fish develop, the range of half-period durations increases (Fig 6G)—young larvae use mostly short durations, whereas larger larvae use a broad range of durations. The maximum peak bending moment increases substantially over development (Fig 6H). Older fish can generate higher peak bending moments and can reach higher swimming vigour values, but they do not always do so.\n\nControl parameters of swimming vigour\n\nBecause the bending moment patterns are similar across swimming styles and developmental stage, the parameters left for controlling swimming vigour are the amplitude of the bending moment and the duration of the tail beat. All experimental points lie on a broad cloud around a curve through the effort landscape, which is a function of peak bending moment and half beat duration (Fig 7A–7C). In general, high peak bending moments are only produced for tail beats of short duration. As the duration decreases (i.e., frequency increases), the bending moment amplitude decreases. Higher efforts generally lead to higher speeds (Fig 7B), unless the larva is accelerating strongly. Strong accelerations are mostly found with slow-swimming larvae that use short half-beat durations and high peak bending moments (Fig 7A). For high-effort tail beats, the larvae are generally either swimming fast or accelerating: high-effort tail beats at low swimming speeds show high accelerations, whereas high-effort tail beats at low accelerations show high speeds. As a result of the curve fit, swimming vigour increases with increasing effort (Fig 7C, see also Fig 5B).\n\nEffort can be increased either by increasing the peak bending moment or by decreasing the half-beat duration, or a combination of both. To assess how larvae vary these parameters, we divided the half beats into three bins of effort, each with the same number of points (Fig 7D and 7E). For each of these bins, we show the frequency distribution of the peak bending moment (Fig 7D) and the half-beat duration (Fig 7E). Low-effort half beats are usually done with low peak bending moment and relatively long duration with a large spread. In contrast, medium and high-effort half beats tend to occur at similar half-beat durations. The main difference between the middle- and highest-effort bin is in the peak bending moment.\n\nDiscussion\n\nIn this study, we analysed the actuation used during swimming of developing zebrafish larvae by calculating bending moment patterns with inverse dynamics. We found that zebrafish larvae use similar bending moment patterns across development. They adjust their swimming vigour, a combination of speed and acceleration, by changing the peak bending moment and tail-beat duration. At higher speeds and accelerations, the larvae produce the required fluid dynamic forces by increasing bending moment amplitude and/or decreasing tail-beat duration.\n\nPrevious inverse dynamics approaches for the internal mechanics of swimming used simplified models for both the fluid and the structure. The structure was modelled with linear bending theory, assuming small deformations of the centreline [17,19]. The effects of a large-amplitude correction to these were expected to be small for periodically swimming adult fish [33]. However, fish larvae, as well as turning and fast-starting adult fish, beat their tails often at &gt;90° with the head [23,34,35], violating the small-amplitude assumption.\n\nWe compared the previously used small-amplitude beam model [17,19,20] with the new large-amplitude beam model. This showed that our large-amplitude model reconstructs bending moments with considerably lower errors at any amplitude but particularly so at larger amplitudes. The motion amplitude can be summarised with the peak-to-peak tail-beat amplitudes normalised by fish length ℓ, which is usually in the range of 0.1–0.3 for adult fish [32]; for larval zebrafish, it reaches values above 0.5 [23]. At a moderate peak-to-peak tail-beat amplitude of 0.2ℓ, the small-amplitude model showed error peaks of 16.4%, whereas at 0.35ℓ, this had increased to 37.4%. In contrast, our large-amplitude model showed error peaks of, respectively, 0.95% and 5.1% at these same amplitudes. This indicates that the small-amplitude model is inadequate for analysing bending moment distributions of large-amplitude swimming, which occurs in larval fish and many adult fish. Our beam model does ignore the effect of shear deformation that is expected to occur close to the medial plane [36], but we expect it to be of small influence on the bending moments because of its proximity to the axis and hence small moment arm.\n\nIn addition to the large-amplitude beam model, we used three-dimensional CFD to calculate fluid dynamic forces, dropping previous assumptions of inviscid flow [17–19,37] and the necessity to model the boundary layer separately [33]. The assumption of inviscid flow does not hold for fish swimming in the intermediate regime [3,28]—full solution of the Navier–Stokes equations is necessary to obtain sufficiently accurate fluid dynamic force distributions. The intermediate Reynolds number of the zebrafish larvae (45–1,500 in our experimental data) allows us to solve the Navier–Stokes equations accurately, without requiring turbulence modelling [28]. The main limitation on the accuracy of the computed flow fields is the input motion that we reconstructed from high-speed video. However, we expect the resulting error to be limited because the overall motion of the fish is reconstructed accurately, despite local errors in curvature (e.g., near the tail) [21].\n\nIn our analysis of swimming sequences across development, we do not assume periodicity. Periodic motion is a common assumption in the analysis of fish swimming [23,31]. For zebrafish, (near-)cyclic swimming occurs most often after a fast start, generally only for a few tail beats, and is rarely spontaneous [22,38]. To analyse aperiodic motion, we subdivided each swimming sequence in tail beats based on zero crossings of the bending moment in the middle of the body. During aperiodic swimming, the mean speed varies between successive tail beats. For this reason, we define a parameter, swimming vigour, that combines the effects of acceleration and swimming speed as V = m(cv2+a). This approach for analysing aperiodic swimming could be of general use in swimming research. The subdivision in half beats can also be done with quantities other than the bending moment—for example, body curvature. This enables similar analyses of aperiodic swimming from pure kinematics without inverse dynamics.\n\nWe define the swimming effort exerted by the fish based on the amplitude of the bending moment and the duration of the tail beat as E=Mpeakthalf−1. This quantity correlates with resultant power, showing that it is indeed an indicator of amount of effort exerted by the larva (Fig 5A). The speed and acceleration fall on broad clouds as a function of effort (Fig 5C and D) because the required power depends on their combination rather than their individual values. The effort–speed landscape (Fig 5C) shows a two-pronged distribution, with one branch showing high effort but low speed and the other, broader branch showing increased effort with speed. This distribution is mainly explained by the acceleration, showing high values in the lower branch—fish only accelerate strongly from low speeds and use high effort to do so. This is reflected in the effort–acceleration landscape (Fig 5D), with low (including negative) acceleration being found at high speeds, and vice versa.\n\nWhen speed and acceleration are combined into the swimming vigour, these clouds collapse closely to a trend line (Fig 5B). Remaining variation in this trend may be partly caused by turning behaviour and contributions of the pectoral fins. The coefficient c determines the relative contribution of the speed and acceleration to the swimming vigour, giving an indication of their relative cost.\n\nTo gain more insight into these relative contributions, we assume that the contribution of the velocity to the vigour is equal to cd12ρSv2, where cd is the drag coefficient, ρ is the fluid density, and S is the wetted area of the fish [30]. Furthermore, we assume that the contribution of acceleration is given by m(1+cm)a, where cm is the added mass coefficient [39,40]. The drag coefficient was calculated to be 0.26 in a previous CFD study on larval zebrafish [30]. Given that the vigour coefficient c is the ratio between the velocity contribution and the acceleration contribution, we can derive the added mass coefficient to be 3.26. This indicates that the fish experiences a fluid acceleration reaction upon accelerating that is 3.26 times larger than its own mass. For a flat plate accelerating perpendicular to the flow, the theoretical added mass coefficient is 1 [39], and for eels swimming at a Reynolds number of 16,000–120,000, the added mass coefficient was estimated to be 2.8 ± 0.8 [40]. Although our larvae fish swim at a much lower Reynolds number than the eel, their added mass coefficient is thus similar.\n\nMost of the resultant power produced by the fish during near-periodic swimming is used to increase the energy in the fluid rather than the kinetic energy of the body (Fig 4H). The energy spent on the water is likely lost on lateral velocity: larvae swim at high Strouhal number, which is associated with large tail-beat amplitudes and relatively high energy consumption [23,41]. Most of this fluid power is produced at the tail, where the largest fluid dynamic forces are produced [30], even though no muscles are present here. This suggests a transfer mechanism by passive tissues from the muscles to the tail [42–44]. The ratio of kinetic power of the body and resultant power might be higher during fast starts and hence deserves further research.\n\nThe bending moment does not correspond directly to muscle action because it also includes the effects of passive structures inside the body [17]. We do not know the contribution of the muscles to the total bending moment, nor do we know the specific distribution of stresses inside the body. Cheng and colleagues [20] modelled the elastic and viscoelastic properties of the passive tissue and thus estimated the contribution of the muscle bending moment. The amplitude of the muscle bending moment was found to be higher than the overall bending moment, whereas the wave speed was found to be lower. However, the overall dynamics look reasonably similar. If we assume similar distributions of passive tissues inside the fish across the considered developmental stages [24], similar total bending moment patterns will require a similar muscle contribution. Furthermore, the difference in amplitude between similar bending moment patterns must originate from the muscle moment because it is the only net source of power in the system—the work done by the fluid and passive tissues indirectly comes from the muscles.\n\nWe found that the bending moments follow a similar pattern across development and swimming vigour (i.e., speed and acceleration). The only significant coefficient in the linear models is the phase of the centre of volume of the bending moment patterns as a function of swimming vigour (Fig 6F), but the effect is limited. More vigorously swimming fish generate the peak bending moment slightly earlier in the half beat.\n\nThe mean bending moment pattern looks qualitatively similar to earlier calculations done for adult fish [19]. It is a single-peaked distribution, with the maximum around the bulk of the muscle (Figs 4E and Fig 6A) and a fast-travelling wave character. Muscle electromyograms (EMGs) during visually induced fictive swimming done on paralysed zebrafish looked similar to activation patterns in adult fish [13]. This suggests that this simple pattern of bending moments is common to fish across species and developmental stage. Even though fish larvae swim in the intermediate regime [3], and adult fish often swim in the inertial regime [45], the differences in fluid dynamics do not seem to require fundamentally different bending moment patterns.\n\nFor accelerating motions, swimming kinematics have been observed to be similar and hydrodynamically optimal across a wide range of body shapes and sizes [46]. In bluegill sunfish, muscle activation patterns have been measured during acceleration, showing that they effectively stiffen their bodies by coactivating muscles on both sides of the body [47]. This raises an interesting question: Is this activation pattern conserved across fish species to effectively produce acceleration? Our method could help answer this question by making it possible to reconstruct internal mechanics from only kinematics, without requiring invasive EMG.\n\nBecause the bending moments look similar along the body and over the phase for each half beat, the two parameters left for the larvae to adjust for each half beat are the amplitude of the bending moment and its duration (Fig 7D and 7E). Young larvae use a relatively narrow range of amplitudes (Fig 6H) and half-beat durations (Fig 6G), which broadens as the fish develop. Older larvae are able to generate higher peak bending moments, which is likely correlated to development of their muscle system [48]. Furthermore, older larvae use a broader range of tail-beat durations than young larvae, suggesting that older larvae have more freedom to control their swimming vigour. The relative contributions of the peak bending moment and half-beat duration depend on the magnitude of the effort. At low efforts, a wide range of half-beat durations is used, but when the effort is increased, this parameter saturates (Fig 7E) as the larvae approach their maximum muscle contraction frequency of 90–100 Hz [22,23]. For further increase of the effort, the peak bending moment must increase (Fig 7D).\n\nSwimming kinematics emerge from simple bending moment patterns. These patterns presumably stem from simple muscle activation input—their quantification is an interesting avenue for future research. The arrangement and properties of the muscles, passive tissues, and propulsive surface cause simple inputs to translate into complex kinematics and flow fields. This has profound consequences for larvae that need to swim to survive [49]. Straight from the egg, larval fish can produce swimming behaviour to escape threats despite relatively limited neural processing capacity. This concept of designing passive systems to allow complex systems to be actuated simply is of broad interest in engineering and biology [50–52]. Because bony fish larvae are similar in morphology across many species [53], we expect that these results are relevant for bony fish in general. The simple actuation solution may have been instrumental in the evolution and adaptive radiation of bony fish, with more than 30,000 extant species.\n\nWe demonstrated the novel methodology on the specific example of larval zebrafish. There are numerous other potential applications for this method in the field of fish swimming. For example, an extensive analysis of turning fish could clarify how they produce this turning motion. In a recent study of fast-starting larval fish [54], it was found that fish larvae can independently control their escape speed and turning angle. The here-developed methodology could help to elucidate the required underlying actuation patterns. Another interesting application would be to analyse a large data set of adult fish swimming at different speeds and accelerations. This would allow assessment of whether adult fish also use similar bending moment patterns across speeds, whether these patterns are similar to larval fish, and how these patterns are affected by body morphology (i.e., distributions of muscle fibres and passive tissue components). The combination of analysing three-dimensional kinematics and fluid dynamics and use of a large-amplitude deformation model not only opens the doors to a broad range of studies into the fluid–structure interaction of fish swimming but also to other undulatory swimmers, such as aquatic snakes and worms.\n\nMaterials and methods\n\nHere, we summarise the main steps of our methodological approach. An in-depth mathematical treatment of the methods is given in S1 Text. Source codes of the computational methods can be found in the accompanying data repository [27].\n\nEthics statement\n\nThe experiment complies to the Dutch Act on Animal Experiments, which complies with European Directive 86/609/EEC, and was approved by the animal welfare authority (DEC Wageningen University, the Netherlands). The institutional licence number to conduct animal experiments is 10400. The protocol number of the approved experiment is 2013087.b, projectcode LarvalSwim, experimental code 2013096.\n\nReconstructing three-dimensional motion from multicamera high-speed video\n\nWe made high-speed video recordings of fast starts of three separate batches of 50 zebrafish larvae from 3–12 dpf. The camera setup was identical to the setup described in Voesenek and colleagues [21], with three synchronised high-speed video cameras recording free-swimming larvae at 2,000 frames per second. To reconstruct the swimming kinematics from the recorded high-speed video, we used automated three-dimensional tracking software developed in-house [21] in MATLAB (R2013a, The Mathworks). For every time point in a multicamera video sequence, the software calculated the best fit for the larva’s three-dimensional position, orientation, and body curvature to the video frames. These parameters were then used to calculate the position of the larva’s central axis and the motion of its outer surface (Fig 1A and 1B).\n\nSubdividing motion\n\nWe calculated phase-averaged quantities for an individual swimming sequence to look in detail at the generated bending moments and powers. We determined whether a (subset of a) sequence is periodic with a similar approach to Van Leeuwen and colleagues [23]. For every possible subset of a swimming sequence, we calculated the sum of absolute difference with a time-shifted version of the curvature, similar to an autocorrelation. We then calculated extrema in this function—if extrema are detected, their maximum value determines the ‘periodicity’ of the sequence. We then selected the longest possible subsequence that has a periodicity value higher than a threshold of 35—this is a swimming sequence for a 3-dpf fish. We divided this sequence into half phases based on peaks in the body angle [21,23]. The curvature, bending moment, fluid power, kinetic power, and resultant power were then phase averaged based on these subdivisions.\n\nMost of the swimming of larval zebrafish is aperiodic, and long bouts of tail beats at the same frequency and amplitude are rare. Therefore, the common approach of analysing fish swimming as a periodic phenomenon is therefore not appropriate. As an alternative, we divide each swimming bout in half tail beats, and for each, we can determine a mean swimming speed and acceleration. We mirror all half beats toward the left side of the fish such that all extracted half beats were in the same direction. This approach allows us to systematically analyse aperiodic motion, opening up a much larger fraction of the data set for investigation.\n\nWe used the bending moment patterns to divide the swimming motion into half tail beats—we defined the start of each half tail beat as the moment at which the bending moment at 0.5ℓ crossed the zero line. Since some of these zero crossings are related to noise, we evaluated every possible permutation of zero crossings per sequence on several criteria with a custom MATLAB (R2018b, The Mathworks) programme. We eliminated zero crossings with neighbouring sections with an amplitude of less than 5% of the peak half-beat amplitude in the sequence because they are most probably noise. We required more than three zero crossings to have at least two half beats to be able to calculate a mean acceleration. Extreme values in each half beat should alternate direction to eliminate noisy zero crossings: the larva beats its tail left and right; therefore, bending moment must alternate. Finally, we eliminated half beats with a duration shorter than 2.5 ms (equivalent to 200-Hz tail-beat frequency)—the maximum tail-beat frequency observed for zebrafish larvae is 95 Hz [23]. From all permutations that met the criteria, we selected the permutation with the smallest standard deviation in half-period length across the sequence. This left the longest possible, least noisy sequence of half beats for every swimming bout.\n\nOut of 113 swimming sequences, we selected 398 half beats with this procedure. For each of these half beats, we calculated the duration, mean speed, and peak bending moment. We determined the mean acceleration by calculating the difference in mean speed (i.e., velocity magnitude) between the following and current half beat and dividing by the time difference between the tail-beat midpoints. Because we could not calculate mean acceleration for the last half beat in each sequence, 285 half beats remained for which we computed all quantities.\n\nCalculating fluid force distributions\n\nThe equations of motion include an external force distribution, which is produced by the water on the skin. Because this distribution is exceedingly difficult to measure directly and noninvasively, we modelled the fluid dynamics numerically. Previous approaches used inviscid fluid models to calculate fluid force distributions [17,19,20]. However, at the intermediate Reynolds number regime of the larval fish, these models are inaccurate because a considerable fraction of the forces are generated through viscous effects [30]. Instead, we perform CFD to calculate solutions of the full Navier–Stokes equations. This results in an accurate representation of the fluid force distributions because all flow scales can be represented numerically [28]. We used two independent CFD methods to calculate fluid dynamic forces.\n\nWe performed CFD using a Navier–Stokes solver based on overset meshes [28–30] coupled to a body dynamics solver to simulate free swimming. Simulations were performed with swimming kinematics based on a travelling wave with a known curvature amplitude at a frequency of 50 Hz. The same motion was used in a second independent Navier–Stokes solver based on the immersed boundary method, the open-source code IBAMR [55]. We used an experimentally validated method to validate the second method to assess its accuracy when calculating internal forces and moments.\n\nThe Navier–Stokes equations were solved on a rectangular domain, with extents determined by the bounding box around the complete motion with an additional margin of two fish lengths. The immersed boundary solver used an adaptive mesh refinement approach in which the computational mesh can be locally refined depending on the flow conditions. In our case, the mesh consisted of four levels of refinement. Each level was a simple rectangular Cartesian mesh with four times the number of subdivisions in all dimensions compared with the coarser level. The choice of mesh refinement level depended on the local value of the vorticity; we chose thresholds of absolute vorticity of 1 s−1, 25 s−1, and 250 s−1 to switch to the second, third, and fourth refinement levels, respectively. We used a fixed time step of 0.5 μs (see section 6 in S1 Text), in which the Courant–Friedrichs–Lewy (CFL) number is always much smaller than 1 (i.e., the fluid moves much less than a grid step in a single time step). We saved the fluid solution every 0.25 ms, at which we reconstructed the internal forces and moments.\n\nThe surface of the fish was described as a cloud of Lagrangian points moving over the Eulerian fluid solution mesh. The motion of these points was prescribed based on quintic spline interpolation [56] of the tracked kinematics with a custom-developed add-on to IBAMR written in C++. This add-on reads the three-dimensional tracked data and interpolates it to the solver time steps. It then uses these data to calculate the position and velocity of a point cloud that was generated based on the three-dimensional surface model. We use a hollow point cloud describing the surface to prevent the existence of a nondivergence-free velocity field inside the fish that could disturb the external flow field. The density of this point cloud was chosen such that the mean distance between the points is 75% of the density of the smallest mesh level. This ensured that each mesh cell inside the fish body will have at least one body surface point in it and not much more.\n\nBecause we use a hollow point cloud that allows for flow inside the fish, we cannot directly use the immersed boundary forces on the Lagrangian points to calculate the force distribution. Instead, we postprocess the resulting three-dimensional velocity and pressure fields (Fig 1C) to extract the fluid force distribution on the skin of the fish with a custom Python 3 programme. In this programme, we interpolated the pressure and velocity gradients to a triangulated surface slightly offset from the fish skin [57]. We then integrated these values into contributions to the pressure force and the shear force at every face of the surface (Fig 1D). By further integration, we calculated the force at every point along the centreline in a coordinate system attached to the larva’s head (Fig 1E).\n\nCalculating bending moments\n\nTo calculate bending moments, we represented the fish by its central axis only. Effects of muscles, spine, and other tissues were combined for every transversal slice along this axis. This simplification allowed us to describe the fish as a nonlinear, one-dimensional beam in two-dimensional space.\n\nWe derived the equations of motion for this beam in an accelerating and rotating coordinate system attached to the fish’s head (see S1 Text for details) [58]. We modelled the fish as a beam with varying cross sections undergoing arbitrarily large deformation. Plane cross sections are assumed to remain plane and perpendicular to the neutral line (no shear deformation), but axial deformation is allowed. In our tracking method, we assume that the fish deforms in a single plane (with an arbitrary three-dimensional position and orientation). Therefore, if we derive the equations in a reference frame attached to this deformation plane, we can use a two-dimensional beam model to represent the deformation of the fish. Because we chose to attach the noninertial reference frame to the head of the fish, the model contains both translation and rotational accelerations with respect to the inertial reference frame. We take these accelerations into account using fictitious forces [58].\n\nIn summary, we model the fish as a beam undergoing large bending deformations in two dimensions, leading to the following equations of motion expressed in a reference frame attached to the head of the fish (see section 1 in S1 Text for the derivation, and Fig S1 for definitions of the symbols):\n\nwhere s denotes the coordinate along the central axis of the fish; t denotes time; ρfish is the mass density of the fish; A is the cross-sectional area distribution; I is the second moment of area distribution; ξ and η are the displacement in, respectively, the x and y direction with respect to the undeformed configuration; θ is the deformation angle; N is the normal force; Q is the shear force; and M is the bending moment.\n\nIn these equations, most terms were known from the three-dimensional surface model (the area and second moment of area distributions), the tracked video (the x and y displacement, deformation angle, and fictitious forces), and the CFD (the fluid forces and moment). The to-be-calculated unknown terms in the equations were the net normal forces, shear forces, and the bending moment. We described the distributions of these unknowns with quintic splines with uniformly spaced control points along the axis [56].\n\nTo determine the control point values of the normal force, shear force, and bending moment, we minimised the residuals of the equations of motion. For every trial combination of control points, we calculated the residuals of equations at all points along the fish. The squared sum of these normalised residuals was minimised with a Levenberg–Marquardt algorithm [57] to obtain the best-fitting control point values that meet the boundary conditions for both free ends (internal forces and moments are zero). When the residuals of the equations are equal to zero, the optimised distributions satisfy the governing equations and boundary conditions exactly. Therefore, this procedure ensured that the computed internal force and moment distributions (Fig 1F) were as close to physically valid as possible within the measurement error. From the motion of the centreline and fluid dynamic forces, we derived a local resultant power.\n\nThis optimisation procedure was validated with reference data obtained by integrating the equations of motion with a known external force distribution and internal moment distribution. We then reconstructed the bending moments, shear force, and normal force from the integrated motion and the prescribed external force distribution starting from different initial conditions, resulting in near-identical values (see section 5 in S1 Text).\n\nThe bending moment data were also used to calculate the resultant power from the fluid dynamic forces and the changes in kinetic energy. Note that we cannot calculate a meaningful value for the internal power, because we do not separate passive and active effects. The net power when combining these effects does not correspond to the actual power consumption of the fish, as the passive and active components might partly compensate each other.\n\nComparing with a small-amplitude beam model\n\nTo compare our method to the previously used small-amplitude model [17,19,20], we reimplemented this model in Python, including periodic motion model, based on the original studies [17,31]. We reimplemented the periodic motion model from these studies, which is based on a truncated Fourier series. We fitted the Fourier coefficients to swimming motion with a least-squares method [59] to represent the motion of the reference swimmer as a series of Fourier coefficients. In addition, we reimplemented the bending moment reconstruction method from the previous study [17] in Python. We manually digitised the amplitude and phase of displacement, curvature, and bending moment in their graphs (their Figs 4 and 5) and ran the reimplemented method on these data to verify that it gives near-identical results to the original method.\n\nWe applied the method to motion generated by integrating the beam equations with prescribed fluid force and muscle moment distributions (see S1 Text). We generated data sets for three different motion amplitudes by setting the amplitude of the muscle moment distribution to 2, 4, and 8 μN mm, resulting in peak-to-peak tail-beat amplitudes normalised by the fish lengths of 0.12, 0.20, and 0.35. First, we fitted Fourier coefficients (odd modes 1 through 9) to the lateral displacement, which we define as the displacement in y direction (i.e., η in our notation); the displacement in x direction is not taken into account by the small-amplitude model. We also represent the lateral fluid force distribution as a series of Fourier coefficients; this is trivial because it is given by a pure cosine.\n\nWith the data in this form, we used the small-amplitude method to obtain the Fourier coefficients for the bending moment. To compare, we also applied our moment reconstruction method to the unfitted data.\n\nCalculating muscle cross-sectional area\n\nWe performed micro-computed-tomography (μCT) images of a 3-dpf zebrafish larva at the TOMCAT beamline at the Paul Scherrer Institut [60]. The larva was fixed in Bouin’s solution and stained with phosphotungstic acid (PTA). The complete fish was imaged by stitching three scans with a resolution of 650 × 650 × 650 nm per voxel. From these data, a centreline was extracted by finding the centre of area of each slice, segmented with simple thresholding. Finally, the muscle area was manually digitised in 51 planes, for which the image data were interpolated in a plane perpendicular to the centreline.\n\nSupporting information"
}